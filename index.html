<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Remote Keyboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#111; color:#eee; font-family:sans-serif; padding:10px;
}
input, textarea, button {
  width:100%; margin:6px 0; padding:10px; font-size:16px;
}
button { background:#333; color:#fff; border:none; }
pre {
  background:#000; padding:10px; height:180px; overflow:auto;
}
</style>
</head>
<body>

<h2>ğŸ“± Remote Keyboard</h2>

<input id="room" placeholder="Room ID">
<textarea id="text" placeholder="ã“ã“ã«å…¥åŠ›ï¼ˆãƒ•ãƒªãƒƒã‚¯å¯ï¼‰"></textarea>

<button id="send">é€ä¿¡</button>
<button id="ime">å…¨è§’ / åŠè§’ åˆ‡æ›¿</button>

<pre id="log"></pre>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from
  "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

/* Firebaseè¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyB3QCa8l8X9LQwZVyrYlOw4bQeP1C0QMnU",
  authDomain: "key-board-ee542.firebaseapp.com",
  databaseURL: "https://key-board-ee542-default-rtdb.firebaseio.com",
  projectId: "key-board-ee542",
  storageBucket: "key-board-ee542.firebasestorage.app",
  messagingSenderId: "772948787294",
  appId: "1:772948787294:web:59e38171fa37398b4834cf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const logBox = document.getElementById("log");
const roomInput = document.getElementById("room");
const textInput = document.getElementById("text");

function log(msg){
  logBox.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  logBox.scrollTop = logBox.scrollHeight;
}

/* é€ä¿¡ï¼ˆ1æ–‡å­—ãšã¤ï¼‰ */
document.getElementById("send").onclick = async () => {
  const room = roomInput.value.trim();
  if(!room){ alert("Room ID å…¥ã‚Œã¦"); return; }

  const text = textInput.value;
  for(const ch of text){
    await set(ref(db, `rooms/${room}/input`), {
      type: "char",
      key: ch,
      time: Date.now()
    });
  }
  log("é€ä¿¡å®Œäº†");
  textInput.value = "";
};

/* å…¨è§’ / åŠè§’ */
document.getElementById("ime").onclick = async () => {
  const room = roomInput.value.trim();
  if(!room){ alert("Room ID å…¥ã‚Œã¦"); return; }

  await set(ref(db, `rooms/${room}/input`), {
    type: "ime",
    time: Date.now()
  });
  log("IMEåˆ‡æ›¿é€ä¿¡");
};

/* PCå´ã‹ã‚‰ã®å—ä¿¡ãƒ­ã‚°ï¼ˆä»»æ„ï¼‰ */
onValue(ref(db, "rooms"), snap => {
  if(snap.exists()){
    log("PCæ¥ç¶šã‚ã‚Š");
  }
});
</script>

</body>
</html>
