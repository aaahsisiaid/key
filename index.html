<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Remote Keyboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { background:#111; color:#eee; font-family:sans-serif; padding:10px }
textarea, input, button, select {
  width:100%; margin:6px 0; padding:10px; font-size:16px;
}
button { background:#333; color:#fff; border:none }
pre { background:#000; height:160px; overflow:auto; padding:10px }
</style>
</head>
<body>

<h2>ğŸ“± Remote Keyboard</h2>

<input id="room" placeholder="Room ID">

<select id="mode">
  <option value="realtime">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›</option>
  <option value="enter">Enterã§é€ä¿¡</option>
</select>

<textarea id="text" placeholder="ã“ã“ã«å…¥åŠ›"></textarea>

<button id="send">é€ä¿¡</button>
<button id="enter">Enterï¼ˆæ”¹è¡Œï¼‰</button>
<button id="back">å‰Šé™¤</button>
<button id="ime">å…¨è§’ / åŠè§’</button>

<pre id="log"></pre>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set } from
  "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB3QCa8l8X9LQwZVyrYlOw4bQeP1C0QMnU",
  authDomain: "key-board-ee542.firebaseapp.com",
  databaseURL: "https://key-board-ee542-default-rtdb.firebaseio.com",
  projectId: "key-board-ee542",
  appId: "1:772948787294:web:59e38171fa37398b4834cf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const logBox = document.getElementById("log");
const text = document.getElementById("text");
const mode = document.getElementById("mode");
const roomInput = document.getElementById("room");

function log(m){
  logBox.textContent += m + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

async function send(data){
  const room = roomInput.value.trim();
  if(!room) return alert("Room ID å…¥ã‚Œã¦");
  await set(ref(db, `rooms/${room}/input`), data);
}

text.addEventListener("input", async e => {
  if(mode.value !== "realtime") return;
  const v = e.data;
  if(v){
    await send({ type:"char", key:v, time:Date.now() });
    log("é€ä¿¡: " + v);
  }
});

document.getElementById("send").onclick = async () => {
  for(const ch of text.value){
    await send({ type:"char", key:ch, time:Date.now() });
  }
  text.value="";
  log("ã¾ã¨ã‚é€ä¿¡å®Œäº†");
};

document.getElementById("enter").onclick = async () => {
  await send({ type:"enter", time:Date.now() });
  log("Enter");
};

document.getElementById("back").onclick = async () => {
  await send({ type:"backspace", time:Date.now() });
  log("Backspace");
};

document.getElementById("ime").onclick = async () => {
  await send({ type:"ime", time:Date.now() });
  log("IMEåˆ‡æ›¿");
};
</script>
</body>
</html>
