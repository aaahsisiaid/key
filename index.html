<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“± Remote Keyboard Pro</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  color: #eee;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  padding: 16px;
  min-height: 100vh;
}
.container {
  max-width: 800px;
  margin: 0 auto;
}
h1 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 28px;
  background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}
input, textarea, button, select {
  width: 100%;
  margin: 8px 0;
  padding: 12px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
input, textarea, select {
  background: rgba(255, 255, 255, 0.1);
  color: #eee;
}
input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: #4facfe;
  box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
}
button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 600;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}
button:active {
  transform: translateY(0);
}
button.primary { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
button.danger { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
button.success { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
button.small {
  width: calc(50% - 4px);
  display: inline-block;
  padding: 10px;
  font-size: 14px;
}
button.small:nth-child(even) { margin-left: 8px; }
.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}
.grid button {
  width: 100%;
  margin: 0;
}
.status {
  padding: 12px;
  border-radius: 8px;
  margin: 8px 0;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.status.online {
  background: linear-gradient(135deg, rgba(0, 255, 127, 0.2) 0%, rgba(0, 200, 100, 0.2) 100%);
  border: 1px solid rgba(0, 255, 127, 0.3);
}
.status.offline {
  background: linear-gradient(135deg, rgba(255, 100, 100, 0.2) 0%, rgba(200, 0, 0, 0.2) 100%);
  border: 1px solid rgba(255, 100, 100, 0.3);
}
.status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #0f0;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
pre {
  background: #000;
  height: 200px;
  overflow-y: auto;
  padding: 12px;
  border-radius: 8px;
  font-size: 12px;
  line-height: 1.6;
  font-family: 'Courier New', monospace;
}
.stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin: 12px 0;
}
.stat-box {
  background: rgba(79, 172, 254, 0.1);
  padding: 12px;
  border-radius: 8px;
  text-align: center;
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: #4facfe;
}
.stat-label {
  font-size: 12px;
  opacity: 0.7;
  margin-top: 4px;
}
.tab-container {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.tab {
  flex: 1;
  padding: 12px;
  background: rgba(255, 255, 255, 0.05);
  border: none;
  border-radius: 8px;
  color: #eee;
  cursor: pointer;
  transition: all 0.3s;
}
.tab.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}
.shortcuts {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“± Remote Keyboard Pro v2.0</h1>

  <div class="card">
    <input id="room" placeholder="Room ID" value="test">
    <div id="status" class="status offline">
      <div class="status-dot"></div>
      <span>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</span>
    </div>
  </div>

  <div class="stats">
    <div class="stat-box">
      <div class="stat-value" id="sent-count">0</div>
      <div class="stat-label">é€ä¿¡æ•°</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="char-count">0</div>
      <div class="stat-label">æ–‡å­—æ•°</div>
    </div>
    <div class="stat-box">
      <div class="stat-value" id="uptime">00:00</div>
      <div class="stat-label">æ¥ç¶šæ™‚é–“</div>
    </div>
  </div>

  <div class="tab-container">
    <button class="tab active" data-tab="input">å…¥åŠ›</button>
    <button class="tab" data-tab="shortcuts">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</button>
    <button class="tab" data-tab="mouse">ãƒã‚¦ã‚¹</button>
    <button class="tab" data-tab="advanced">é«˜åº¦</button>
  </div>

  <!-- å…¥åŠ›ã‚¿ãƒ– -->
  <div class="tab-content active" id="input-tab">
    <div class="card">
      <select id="mode">
        <option value="realtime">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›</option>
        <option value="enter">Enterã§é€ä¿¡</option>
      </select>
      <textarea id="text" rows="5" placeholder="ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
      <button id="send" class="primary">ğŸ“¤ é€ä¿¡</button>
    </div>

    <div class="card">
      <div class="grid">
        <button id="enter">â Enter</button>
        <button id="tab">â‡¥ Tab</button>
        <button id="escape">â‹ Esc</button>
        <button id="back" class="danger">âŒ« Back</button>
        <button id="delete" class="danger">âŒ¦ Del</button>
        <button id="ime">ğŸŒ IME</button>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-bottom: 12px;">çŸ¢å°ã‚­ãƒ¼</h3>
      <div class="grid">
        <div></div>
        <button id="arrow-up">â†‘</button>
        <div></div>
        <button id="arrow-left">â†</button>
        <button id="arrow-down">â†“</button>
        <button id="arrow-right">â†’</button>
      </div>
    </div>
  </div>

  <!-- ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¿ãƒ– -->
  <div class="tab-content" id="shortcuts-tab">
    <div class="card">
      <div class="shortcuts">
        <button id="ctrl-c">ğŸ“‹ ã‚³ãƒ”ãƒ¼ (Ctrl+C)</button>
        <button id="ctrl-v">ğŸ“„ è²¼ä»˜ (Ctrl+V)</button>
        <button id="ctrl-x">âœ‚ï¸ åˆ‡å– (Ctrl+X)</button>
        <button id="ctrl-z">â†©ï¸ æˆ»ã™ (Ctrl+Z)</button>
        <button id="ctrl-a">ğŸ”˜ å…¨é¸æŠ (Ctrl+A)</button>
        <button id="clear" class="danger">ğŸ—‘ï¸ å…¨å‰Šé™¤</button>
      </div>
    </div>
  </div>

  <!-- ãƒã‚¦ã‚¹ã‚¿ãƒ– -->
  <div class="tab-content" id="mouse-tab">
    <div class="card">
      <h3 style="margin-bottom: 12px;">ãƒã‚¦ã‚¹åˆ¶å¾¡</h3>
      <div style="margin: 12px 0;">
        <label>Xåº§æ¨™: <span id="mouse-x-display">0</span></label>
        <input type="range" id="mouse-x" min="0" max="1920" value="960" style="margin-top: 8px;">
      </div>
      <div style="margin: 12px 0;">
        <label>Yåº§æ¨™: <span id="mouse-y-display">0</span></label>
        <input type="range" id="mouse-y" min="0" max="1080" value="540" style="margin-top: 8px;">
      </div>
      <button id="mouse-move" class="primary">ğŸ–±ï¸ ãƒã‚¦ã‚¹ç§»å‹•</button>
      <button id="mouse-click" class="success">ğŸ‘† ã‚¯ãƒªãƒƒã‚¯</button>
    </div>
  </div>

  <!-- é«˜åº¦ã‚¿ãƒ– -->
  <div class="tab-content" id="advanced-tab">
    <div class="card">
      <h3 style="margin-bottom: 12px;">ãƒãƒƒãƒå‡¦ç†</h3>
      <input type="number" id="repeat-count" placeholder="ç¹°ã‚Šè¿”ã—å›æ•°" value="1" min="1" max="100">
      <input type="text" id="repeat-text" placeholder="ç¹°ã‚Šè¿”ã™ãƒ†ã‚­ã‚¹ãƒˆ">
      <button id="batch-send" class="primary">ğŸ”„ ãƒãƒƒãƒé€ä¿¡</button>
    </div>

    <div class="card">
      <h3 style="margin-bottom: 12px;">ã‚¯ã‚¤ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰</h3>
      <button id="multi-back">âŒ« Ã— 10 å‰Šé™¤</button>
      <button id="multi-enter">â Ã— 3 æ”¹è¡Œ</button>
    </div>
  </div>

  <div class="card">
    <pre id="log"></pre>
    <button id="clear-log" class="small danger">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    <button id="export-log" class="small">ãƒ­ã‚°å‡ºåŠ›</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from
  "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB3QCa8l8X9LQwZVyrYlOw4bQeP1C0QMnU",
  authDomain: "key-board-ee542.firebaseapp.com",
  databaseURL: "https://key-board-ee542-default-rtdb.firebaseio.com",
  projectId: "key-board-ee542",
  appId: "1:772948787294:web:59e38171fa37398b4834cf"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// DOMè¦ç´ 
const logBox = document.getElementById("log");
const text = document.getElementById("text");
const mode = document.getElementById("mode");
const roomInput = document.getElementById("room");
const statusEl = document.getElementById("status");
const sentCountEl = document.getElementById("sent-count");
const charCountEl = document.getElementById("char-count");
const uptimeEl = document.getElementById("uptime");

// çµ±è¨ˆ
let sentCount = 0;
let charCount = 0;
let startTime = Date.now();

// ã‚¿ãƒ–åˆ‡æ›¿
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
  });
});

// ãƒ­ã‚°é–¢æ•°
function log(message) {
  const timestamp = new Date().toLocaleTimeString();
  logBox.textContent += `[${timestamp}] ${message}\n`;
  logBox.scrollTop = logBox.scrollHeight;
}

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–
function watchStatus() {
  const room = roomInput.value.trim();
  if (!room) return;

  const statusRef = ref(db, `rooms/${room}/status`);
  onValue(statusRef, (snapshot) => {
    const data = snapshot.val();
    if (data && data.online) {
      const timeDiff = Date.now() - data.last_seen;
      const isOnline = timeDiff < 10000;
      
      statusEl.className = `status ${isOnline ? 'online' : 'offline'}`;
      statusEl.innerHTML = `
        <div class="status-dot"></div>
        <span>${isOnline ? 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³' : 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³'} | v${data.version || 'ä¸æ˜'}</span>
      `;
    }
  });
}

// é€ä¿¡é–¢æ•°
async function send(data) {
  const room = roomInput.value.trim();
  if (!room) {
    alert("âš ï¸ Room ID ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return false;
  }

  try {
    await set(ref(db, `rooms/${room}/input`), data);
    sentCount++;
    sentCountEl.textContent = sentCount;
    return true;
  } catch (error) {
    console.error("é€ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
    log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
    return false;
  }
}

// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…¥åŠ›
text.addEventListener("input", async (e) => {
  if (mode.value !== "realtime" || !e.data) return;
  
  const success = await send({
    type: "char",
    key: e.data,
    time: Date.now()
  });
  
  if (success) {
    charCount++;
    charCountEl.textContent = charCount;
    log(`å…¥åŠ›: "${e.data}"`);
  }
});

// é€ä¿¡ãƒœã‚¿ãƒ³
document.getElementById("send").onclick = async () => {
  const content = text.value;
  if (!content) return;

  const success = await send({
    type: "text",
    text: content,
    time: Date.now()
  });
  
  if (success) {
    charCount += content.length;
    charCountEl.textContent = charCount;
    text.value = "";
    log(`âœ… ãƒ†ã‚­ã‚¹ãƒˆé€ä¿¡ (${content.length}æ–‡å­—)`);
  }
};

// åŸºæœ¬ã‚­ãƒ¼
document.getElementById("enter").onclick = () => send({ type: "enter", time: Date.now() }) && log("Enter");
document.getElementById("tab").onclick = () => send({ type: "tab", time: Date.now() }) && log("Tab");
document.getElementById("escape").onclick = () => send({ type: "escape", time: Date.now() }) && log("Escape");
document.getElementById("back").onclick = () => send({ type: "backspace", time: Date.now() }) && log("Backspace");
document.getElementById("delete").onclick = () => send({ type: "delete", time: Date.now() }) && log("Delete");
document.getElementById("ime").onclick = () => send({ type: "ime", time: Date.now() }) && log("IMEåˆ‡æ›¿");

// çŸ¢å°ã‚­ãƒ¼
document.getElementById("arrow-up").onclick = () => send({ type: "arrow_up", time: Date.now() }) && log("â†‘");
document.getElementById("arrow-down").onclick = () => send({ type: "arrow_down", time: Date.now() }) && log("â†“");
document.getElementById("arrow-left").onclick = () => send({ type: "arrow_left", time: Date.now() }) && log("â†");
document.getElementById("arrow-right").onclick = () => send({ type: "arrow_right", time: Date.now() }) && log("â†’");

// ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
document.getElementById("ctrl-c").onclick = () => send({ type: "ctrl_c", time: Date.now() }) && log("Ctrl+C");
document.getElementById("ctrl-v").onclick = () => send({ type: "ctrl_v", time: Date.now() }) && log("Ctrl+V");
document.getElementById("ctrl-x").onclick = () => send({ type: "ctrl_x", time: Date.now() }) && log("Ctrl+X");
document.getElementById("ctrl-z").onclick = () => send({ type: "ctrl_z", time: Date.now() }) && log("Ctrl+Z");
document.getElementById("ctrl-a").onclick = () => send({ type: "ctrl_a", time: Date.now() }) && log("Ctrl+A");
document.getElementById("clear").onclick = () => send({ type: "clear_all", time: Date.now() }) && log("å…¨å‰Šé™¤");

// ãƒã‚¦ã‚¹
document.getElementById("mouse-x").oninput = (e) => {
  document.getElementById("mouse-x-display").textContent = e.target.value;
};
document.getElementById("mouse-y").oninput = (e) => {
  document.getElementById("mouse-y-display").textContent = e.target.value;
};
document.getElementById("mouse-move").onclick = () => {
  const x = parseInt(document.getElementById("mouse-x").value);
  const y = parseInt(document.getElementById("mouse-y").value);
  send({ type: "mouse_move", x, y, time: Date.now() }) && log(`ãƒã‚¦ã‚¹ç§»å‹•: (${x}, ${y})`);
};
document.getElementById("mouse-click").onclick = () => send({ type: "mouse_click", time: Date.now() }) && log("ã‚¯ãƒªãƒƒã‚¯");

// ãƒãƒƒãƒå‡¦ç†
document.getElementById("batch-send").onclick = async () => {
  const count = parseInt(document.getElementById("repeat-count").value);
  const text = document.getElementById("repeat-text").value;
  if (!text) return;

  for (let i = 0; i < count; i++) {
    await send({ type: "text", text, time: Date.now() });
    await new Promise(r => setTimeout(r, 100));
  }
  log(`ğŸ”„ ãƒãƒƒãƒé€ä¿¡å®Œäº†: ${count}å›`);
};

// ã‚¯ã‚¤ãƒƒã‚¯ã‚³ãƒãƒ³ãƒ‰
document.getElementById("multi-back").onclick = () => send({ type: "backspace", count: 10, time: Date.now() }) && log("é€£ç¶šå‰Šé™¤ Ã— 10");
document.getElementById("multi-enter").onclick = async () => {
  for (let i = 0; i < 3; i++) {
    await send({ type: "enter", time: Date.now() });
    await new Promise(r => setTimeout(r, 100));
  }
  log("é€£ç¶šæ”¹è¡Œ Ã— 3");
};

// ãƒ­ã‚°ç®¡ç†
document.getElementById("clear-log").onclick = () => {
  logBox.textContent = "";
  log("ãƒ­ã‚°ã‚¯ãƒªã‚¢");
};

document.getElementById("export-log").onclick = () => {
  const blob = new Blob([logBox.textContent], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `log_${new Date().toISOString()}.txt`;
  a.click();
  log("ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ");
};

// æ¥ç¶šæ™‚é–“æ›´æ–°
setInterval(() => {
  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  const minutes = Math.floor(elapsed / 60);
  const seconds = elapsed % 60;
  uptimeEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}, 1000);

// åˆæœŸåŒ–
log("ğŸ¹ Remote Keyboard Pro v2.0 èµ·å‹•");
watchStatus();
roomInput.addEventListener('change', watchStatus);
</script>
</body>
</html>
